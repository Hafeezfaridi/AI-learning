<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced RAAS & Pharmacology Simulator</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --kidney: #8e44ad;
            --liver: #d35400;
            --adrenal: #f1c40f;
            --lung: #16a085;
            --vessel: #e74c3c;
            --bg: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        h1 { color: var(--primary); margin-bottom: 5px; }
        .subtitle { color: #7f8c8d; margin-bottom: 20px; font-size: 0.9rem; }

        .main-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            justify-content: center;
        }

        /* Visualizer Panel */
        .diagram-box {
            flex: 2;
            min-width: 350px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 10px;
            position: relative;
            height: 600px;
        }

        svg {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            background-color: #fcfdfd;
        }

        /* Control Panel */
        .control-box {
            flex: 1;
            min-width: 300px;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Organ Styles in SVG */
        .organ-shape { transition: filter 0.3s ease, transform 0.3s ease; cursor: pointer; }
        .organ-shape:hover { filter: brightness(1.1); }
        .active-organ { filter: drop-shadow(0 0 8px gold); transform: scale(1.02); }
        
        .pathway-line { 
            stroke: #555; 
            stroke-width: 2; 
            stroke-dasharray: 6; 
            opacity: 0; 
            transition: opacity 0.5s ease; 
        }
        
        .molecule-text { 
            font-size: 12px; 
            font-weight: bold; 
            fill: #333; 
            opacity: 0; 
            transition: opacity 0.5s ease; 
            background: white;
        }

        .vessel-path { transition: stroke-width 1s ease; }

        /* UI Controls */
        label { font-size: 0.85rem; font-weight: bold; color: #bdc3c7; }
        select {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: none;
            font-size: 1rem;
            background: #ecf0f1;
            color: #2c3e50;
            cursor: pointer;
        }

        button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.98); }
        
        .btn-start { background-color: var(--accent); color: white; }
        .btn-next { background-color: #27ae60; color: white; display: none; }
        .btn-reset { background-color: #95a5a6; color: white; margin-top: auto; }
        button:disabled { background-color: #7f8c8d; cursor: not-allowed; }

        /* Dashboard Elements */
        .info-panel {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 15px;
        }

        .bp-meter-container {
            margin-top: 10px;
        }
        .bp-bar-bg {
            height: 24px;
            background: #34495e;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            border: 1px solid #7f8c8d;
        }
        .bp-bar-fill {
            height: 100%;
            width: 50%; /* Normal */
            background: linear-gradient(90deg, #e74c3c 0%, #f1c40f 50%, #2ecc71 100%);
            transition: width 1s ease;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            margin-top: 4px;
            color: #bdc3c7;
        }

        .narrative-box {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 6px;
            min-height: 80px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .highlight-drug { color: #e74c3c; font-weight: bold; background: rgba(255,255,255,0.9); padding: 0 4px; border-radius: 3px; }

        /* Blockade Icon */
        .block-icon { display: none; }
        
    </style>
</head>
<body>

    <h1>RAAS Physiology Explorer</h1>
    <div class="subtitle">Interactive analysis of Blood Pressure regulation and Drug Mechanisms</div>

    <div class="main-container">
        
        <div class="diagram-box">
            <svg viewBox="0 0 600 600" id="mainSvg">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#555" />
                    </marker>
                    <g id="stopSign">
                        <circle cx="0" cy="0" r="14" fill="#c0392b" stroke="white" stroke-width="2"/>
                        <rect x="-10" y="-3" width="20" height="6" fill="white"/>
                    </g>
                </defs>

                <path id="vessel" class="vessel-path" d="M 50 300 L 550 300" stroke="var(--vessel)" stroke-width="20" stroke-linecap="round" opacity="0.8"/>
                <text x="250" y="335" font-size="12" fill="#c0392b" font-weight="bold">SYSTEMIC ARTERIOLES</text>

                <g id="organ-liver" class="organ-shape" transform="translate(40, 40)">
                    <path d="M10,40 Q50,-10 100,40 T150,60 L130,110 L30,100 Z" fill="var(--liver)" />
                    <text x="55" y="70" fill="white" font-size="12" font-weight="bold">LIVER</text>
                    <text x="50" y="85" fill="white" font-size="9">Angiotensinogen</text>
                </g>

                <g id="organ-lungs" class="organ-shape" transform="translate(400, 40)">
                    <path d="M20,80 Q0,40 30,10 Q60,40 90,10 Q120,40 100,80 Q60,110 20,80" fill="var(--lung)" />
                    <text x="45" y="55" fill="white" font-size="12" font-weight="bold">LUNGS</text>
                    <text x="50" y="70" fill="white" font-size="9">ACE</text>
                </g>

                <g id="organ-kidney" class="organ-shape" transform="translate(40, 400)">
                    <path d="M20,20 Q60,0 80,40 Q90,60 70,90 Q40,110 20,80 Q0,50 20,20" fill="var(--kidney)" />
                    <text x="25" y="60" fill="white" font-size="12" font-weight="bold">KIDNEY</text>
                    <circle cx="45" cy="30" r="6" fill="white" opacity="0.3"/>
                    <text x="38" y="33" font-size="8" fill="#333">β1</text>
                </g>

                <g id="organ-adrenal" class="organ-shape" transform="translate(450, 380)">
                    <path d="M10,40 L50,0 L90,40 Z" fill="var(--adrenal)" />
                    <rect x="10" y="42" width="80" height="40" rx="10" fill="#e67e22" opacity="0.8"/>
                    <text x="25" y="70" fill="white" font-size="12" font-weight="bold">ADRENAL</text>
                </g>

                <line id="path-renin" class="pathway-line" x1="80" y1="420" x2="80" y2="150" marker-end="url(#arrowhead)" />
                <text id="lbl-renin" class="molecule-text" x="90" y="280">Renin</text>

                <path id="path-ang1" class="pathway-line" d="M 150 80 L 390 80" marker-end="url(#arrowhead)" fill="none" />
                <text id="lbl-ang1" class="molecule-text" x="230" y="70">Angiotensin I</text>

                <path id="path-ang2" class="pathway-line" d="M 450 100 L 450 280" marker-end="url(#arrowhead)" fill="none" />
                <text id="lbl-ang2" class="molecule-text" x="460" y="200">Angiotensin II</text>

                <path id="path-adrenal" class="pathway-line" d="M 450 300 L 480 370" marker-end="url(#arrowhead)" fill="none" />

                <path id="path-aldo" class="pathway-line" d="M 450 420 L 110 450" marker-end="url(#arrowhead)" fill="none" />
                <text id="lbl-aldo" class="molecule-text" x="250" y="460">Aldosterone</text>

                <g id="block-beta" class="block-icon" transform="translate(70, 380)">
                    <use href="#stopSign" />
                    <text x="20" y="5" font-size="12" fill="#c0392b" font-weight="bold">Beta Blocked</text>
                </g>

                <g id="block-ace" class="block-icon" transform="translate(380, 80)">
                    <use href="#stopSign" />
                    <text x="-40" y="-20" font-size="12" fill="#c0392b" font-weight="bold">ACE Inhibited</text>
                </g>

                <g id="block-arb" class="block-icon" transform="translate(450, 290)">
                    <use href="#stopSign" />
                    <text x="20" y="5" font-size="12" fill="#c0392b" font-weight="bold">Receptor Blocked (ARB)</text>
                </g>

            </svg>
        </div>

        <div class="control-box">
            
            <div>
                <label for="drugSelector">PHARMACOLOGY MODE</label>
                <select id="drugSelector">
                    <option value="none">No Medication (Normal Physiology)</option>
                    <option value="beta">Beta Blocker (e.g., Metoprolol)</option>
                    <option value="ace">ACE Inhibitor (e.g., Lisinopril)</option>
                    <option value="arb">ARB (e.g., Losartan)</option>
                </select>
            </div>

            <div class="info-panel">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <label>STATUS</label>
                    <span id="stage-badge" style="background:#fff; color:#333; padding:2px 6px; border-radius:4px; font-size:0.7rem; font-weight:bold;">RESTING</span>
                </div>
                
                <div class="bp-meter-container">
                    <div class="bp-bar-bg">
                        <div id="bp-fill" class="bp-bar-fill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Hypotensive</span>
                        <span>Normal</span>
                        <span>Hypertensive</span>
                    </div>
                </div>
            </div>

            <div class="narrative-box" id="narrative">
                Select a physiological condition or drug above, then click <strong>Start Simulation</strong> to begin the pathway analysis.
            </div>

            <button id="btn-start" class="btn-start" onclick="startSim()">Start Simulation</button>
            <button id="btn-next" class="btn-next" onclick="nextStep()">Next Step</button>
            <button id="btn-reset" class="btn-reset" onclick="resetSim()">Reset System</button>
        </div>
    </div>

    <script>
        // State Variables
        let step = 0;
        let drugMode = 'none';
        
        // DOM Elements
        const drugSelector = document.getElementById('drugSelector');
        const btnStart = document.getElementById('btn-start');
        const btnNext = document.getElementById('btn-next');
        const narrative = document.getElementById('narrative');
        const bpFill = document.getElementById('bp-fill');
        const stageBadge = document.getElementById('stage-badge');
        const vessel = document.getElementById('vessel');

        // SVG Element Shortcuts
        const paths = {
            renin: document.getElementById('path-renin'),
            ang1: document.getElementById('path-ang1'),
            ang2: document.getElementById('path-ang2'),
            adrenal: document.getElementById('path-adrenal'),
            aldo: document.getElementById('path-aldo')
        };

        const labels = {
            renin: document.getElementById('lbl-renin'),
            ang1: document.getElementById('lbl-ang1'),
            ang2: document.getElementById('lbl-ang2'),
            aldo: document.getElementById('lbl-aldo')
        };

        const organs = {
            kidney: document.getElementById('organ-kidney'),
            liver: document.getElementById('organ-liver'),
            lung: document.getElementById('organ-lungs'),
            adrenal: document.getElementById('organ-adrenal')
        };

        const blocks = {
            beta: document.getElementById('block-beta'),
            ace: document.getElementById('block-ace'),
            arb: document.getElementById('block-arb')
        };

        function startSim() {
            drugMode = drugSelector.value;
            step = 1;
            drugSelector.disabled = true;
            btnStart.style.display = 'none';
            btnNext.style.display = 'block';
            updateUI();
        }

        function nextStep() {
            step++;
            updateUI();
        }

        function resetSim() {
            step = 0;
            drugMode = 'none';
            drugSelector.value = 'none';
            drugSelector.disabled = false;
            btnStart.style.display = 'block';
            btnNext.style.display = 'none';
            btnNext.disabled = false;
            btnNext.innerText = "Next Step";
            btnNext.style.backgroundColor = "#27ae60";

            // Reset Graphics
            bpFill.style.width = "50%";
            bpFill.style.background = "linear-gradient(90deg, #e74c3c 0%, #f1c40f 50%, #2ecc71 100%)";
            vessel.setAttribute('stroke-width', '20');
            
            // Hide paths/labels/blocks
            Object.values(paths).forEach(p => p.style.opacity = 0);
            Object.values(labels).forEach(l => l.style.opacity = 0);
            Object.values(blocks).forEach(b => b.style.display = 'none');
            Object.values(organs).forEach(o => o.classList.remove('active-organ'));

            stageBadge.innerText = "RESTING";
            narrative.innerText = "System Reset. Ready to begin.";
        }

        function showBlockade(type, message) {
            narrative.innerHTML = message;
            btnNext.innerText = "PATHWAY BLOCKED";
            btnNext.disabled = true;
            btnNext.style.backgroundColor = "#c0392b"; // Red
            
            if(type === 'beta') blocks.beta.style.display = 'block';
            if(type === 'ace') blocks.ace.style.display = 'block';
            if(type === 'arb') blocks.arb.style.display = 'block';
        }

        function updateUI() {
            // Clear highlights
            Object.values(organs).forEach(o => o.classList.remove('active-organ'));

            switch(step) {
                case 1: // Stimulus
                    stageBadge.innerText = "STIMULUS";
                    narrative.innerHTML = "<strong>Event:</strong> Blood pressure drops (Hemorrhage, Dehydration). <br> The Kidney detects low perfusion pressure.";
                    bpFill.style.width = "20%"; // Drop BP
                    bpFill.style.background = "#e74c3c"; // Red
                    organs.kidney.classList.add('active-organ');
                    
                    if(drugMode === 'beta') {
                        showBlockade('beta', "<strong>DRUG INTERVENTION:</strong> <span class='highlight-drug'>Beta Blockers</span> block β1 receptors on the Kidney. <br>The signal to release Renin is inhibited. The pathway stops here.");
                    }
                    break;

                case 2: // Renin Release
                    stageBadge.innerText = "RENIN RELEASE";
                    narrative.innerHTML = "<strong>Mechanism:</strong> The Kidney releases the enzyme <strong>Renin</strong> into the bloodstream.";
                    paths.renin.style.opacity = 1;
                    labels.renin.style.opacity = 1;
                    break;

                case 3: // Angiotensin I
                    stageBadge.innerText = "CONVERSION I";
                    narrative.innerHTML = "<strong>Mechanism:</strong> Renin meets Angiotensinogen (from Liver) and converts it into <strong>Angiotensin I</strong>.";
                    organs.liver.classList.add('active-organ');
                    paths.ang1.style.opacity = 1;
                    labels.ang1.style.opacity = 1;
                    break;

                case 4: // ACE / Ang II
                    stageBadge.innerText = "PULMONARY PASS";
                    organs.lung.classList.add('active-organ');
                    
                    if(drugMode === 'ace') {
                        showBlockade('ace', "<strong>DRUG INTERVENTION:</strong> Angiotensin I reaches the lungs, but <span class='highlight-drug'>ACE Inhibitors</span> prevent the enzyme from working. <br>Conversion to the active hormone (Angiotensin II) is blocked.");
                    } else {
                        narrative.innerHTML = "<strong>Mechanism:</strong> Passing through the Lungs, Angiotensin Converting Enzyme (ACE) converts Ang I into <strong>Angiotensin II</strong>.";
                        paths.ang2.style.opacity = 1;
                        labels.ang2.style.opacity = 1;
                    }
                    break;

                case 5: // Vasoconstriction (Ang II Effect)
                    stageBadge.innerText = "VASOCONSTRICTION";
                    
                    if(drugMode === 'arb') {
                         showBlockade('arb', "<strong>DRUG INTERVENTION:</strong> Angiotensin II is formed, but <span class='highlight-drug'>ARBs</span> block the AT1 receptors on blood vessels. <br>The hormone cannot bind, so vasoconstriction does not occur.");
                    } else {
                        narrative.innerHTML = "<strong>Action 1:</strong> Angiotensin II binds to receptors on blood vessels causing constriction. Resistance increases.";
                        vessel.setAttribute('stroke-width', '10'); // Narrowing
                        bpFill.style.width = "35%"; // Rising
                    }
                    break;

                case 6: // Adrenal / Aldosterone
                    stageBadge.innerText = "ALDOSTERONE";
                    organs.adrenal.classList.add('active-organ');
                    paths.adrenal.style.opacity = 1;
                    setTimeout(() => {
                        paths.aldo.style.opacity = 1;
                        labels.aldo.style.opacity = 1;
                    }, 500);
                    
                    narrative.innerHTML = "<strong>Action 2:</strong> Angiotensin II also stimulates the Adrenal Cortex to release <strong>Aldosterone</strong>.";
                    break;

                case 7: // Restoration
                    stageBadge.innerText = "NORMALIZATION";
                    organs.kidney.classList.add('active-organ');
                    narrative.innerHTML = "<strong>Result:</strong> Aldosterone causes the Kidney to retain Sodium and Water. Blood volume rises. <br>Combined with vasoconstriction, <strong>Blood Pressure is restored.</strong>";
                    bpFill.style.width = "50%";
                    bpFill.style.background = "#2ecc71"; // Green
                    btnNext.style.display = 'none';
                    break;
            }
        }
    </script>
</body>
</html>
