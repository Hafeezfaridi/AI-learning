<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANS Physiology Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            border-bottom: 3px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -3px;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .scenario-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .scenario-box h2 {
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .scenario-box p {
            line-height: 1.8;
            font-size: 1.05em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-sympathetic {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-parasympathetic {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn.active {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .organ-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .organ-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .organ-card.sympathetic-active {
            border-color: #f5576c;
            background: linear-gradient(135deg, #fff5f7 0%, #ffe5ea 100%);
            transform: scale(1.02);
        }

        .organ-card.parasympathetic-active {
            border-color: #00f2fe;
            background: linear-gradient(135deg, #f0fcff 0%, #e5f9ff 100%);
            transform: scale(1.02);
        }

        .organ-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .organ-icon {
            font-size: 1.5em;
        }

        .response-section {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .response-section.show {
            display: block;
        }

        .sympathetic-response {
            background: rgba(245, 87, 108, 0.1);
            border-left: 4px solid #f5576c;
        }

        .parasympathetic-response {
            background: rgba(0, 242, 254, 0.1);
            border-left: 4px solid #00f2fe;
        }

        .response-section h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .response-section ul {
            margin-left: 20px;
            line-height: 1.8;
        }

        .neurotransmitter {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin: 5px 5px 5px 0;
        }

        .nt-norepinephrine {
            background: #ffe5ea;
            color: #d63447;
        }

        .nt-acetylcholine {
            background: #e5f9ff;
            color: #0077be;
        }

        .nt-epinephrine {
            background: #fff0e5;
            color: #ff6b35;
        }

        .legend {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .legend h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .legend-items {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 8px;
        }

        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-question {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .quiz-question.correct {
            border-color: #43e97b;
            background: linear-gradient(135deg, #f0fff4 0%, #e5ffe5 100%);
        }

        .quiz-question.incorrect {
            border-color: #f5576c;
            background: linear-gradient(135deg, #fff5f7 0%, #ffe5ea 100%);
        }

        .question-text {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .quiz-option.selected {
            border-color: #667eea;
            background: #e8ecff;
        }

        .quiz-option.correct-answer {
            border-color: #43e97b;
            background: #e5ffe5;
        }

        .quiz-option.wrong-answer {
            border-color: #f5576c;
            background: #ffe5ea;
        }

        .quiz-option:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #e5ffe5;
            color: #2d6a3e;
        }

        .feedback.incorrect {
            background: #ffe5ea;
            color: #d63447;
        }

        .quiz-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .score-display h2 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .score-display p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .quiz-complete {
            display: none;
            text-align: center;
        }

        .quiz-complete.show {
            display: block;
        }

        .performance-badge {
            font-size: 5em;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Autonomic Nervous System Physiology Analyzer</h1>
            <p>Interactive Learning Tool for Medical Students</p>
            <p style="margin-top: 10px; font-style: italic;">Hafeez Faridi Ph.D.</p>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('analyzer')">üìä Organ System Analyzer</button>
                <button class="tab" onclick="switchTab('quiz')">üìù Knowledge Quiz</button>
            </div>

            <div id="analyzer-tab" class="tab-content active">
            <div class="scenario-box">
                <h2>üìã Clinical Scenario</h2>
                <p><strong>Patient: Sarah, 28-year-old marathon runner</strong></p>
                <p>Sarah is preparing for a major race. During rest, she's calm and relaxed. As the race begins, her body must prepare for intense physical activity. Analyze how different divisions of the autonomic nervous system affect her organ systems in these contrasting states.</p>
            </div>

            <div class="controls">
                <button class="btn btn-sympathetic" onclick="activateSympatheticNS()">
                    ‚ö° Activate Sympathetic NS (Fight or Flight)
                </button>
                <button class="btn btn-parasympathetic" onclick="activateParasympatheticNS()">
                    üåø Activate Parasympathetic NS (Rest and Digest)
                </button>
                <button class="btn btn-reset" onclick="resetSystem()">
                    üîÑ Reset System
                </button>
            </div>

            <div class="organ-grid" id="organGrid"></div>

            <div class="legend">
                <h3>üî¨ Neurotransmitter Legend</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffe5ea;"></div>
                        <span><strong>Norepinephrine (NE)</strong> - Primary sympathetic neurotransmitter</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e5f9ff;"></div>
                        <span><strong>Acetylcholine (ACh)</strong> - Parasympathetic neurotransmitter</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fff0e5;"></div>
                        <span><strong>Epinephrine</strong> - Adrenal medulla hormone (sympathetic)</span>
                    </div>
                </div>
            </div>
            </div>

            <div id="quiz-tab" class="tab-content">
                <div class="quiz-container">
                    <div class="score-display">
                        <h2 id="score">0 / 0</h2>
                        <p>Test Your ANS Knowledge</p>
                    </div>

                    <div id="quizQuestions"></div>

                    <div class="quiz-controls">
                        <button class="btn btn-sympathetic" onclick="submitQuiz()">Submit Quiz</button>
                        <button class="btn btn-reset" onclick="resetQuiz()">Reset Quiz</button>
                    </div>

                    <div class="quiz-complete" id="quizComplete">
                        <div class="score-display">
                            <div class="performance-badge" id="performanceBadge"></div>
                            <h2 id="finalScore"></h2>
                            <p id="performanceText"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const organData = {
            heart: {
                name: "Heart",
                icon: "‚ù§Ô∏è",
                sympathetic: {
                    effects: [
                        "Increased heart rate (positive chronotropy)",
                        "Increased contractility (positive inotropy)",
                        "Increased conduction velocity",
                        "Cardiac output increases to 20-25 L/min"
                    ],
                    neurotransmitters: ["Norepinephrine", "Epinephrine"],
                    receptors: "Œ≤1-adrenergic receptors",
                    mechanism: "NE and epinephrine bind to Œ≤1 receptors ‚Üí increased cAMP ‚Üí enhanced Ca¬≤‚Å∫ influx"
                },
                parasympathetic: {
                    effects: [
                        "Decreased heart rate (negative chronotropy)",
                        "Decreased conduction velocity at AV node",
                        "Minimal effect on contractility",
                        "Cardiac output maintained at ~5 L/min at rest"
                    ],
                    neurotransmitters: ["Acetylcholine"],
                    receptors: "M2 muscarinic receptors",
                    mechanism: "ACh binds to M2 receptors ‚Üí decreased cAMP ‚Üí reduced Ca¬≤‚Å∫ influx, increased K‚Å∫ efflux"
                }
            },
            lungs: {
                name: "Lungs",
                icon: "ü´Å",
                sympathetic: {
                    effects: [
                        "Bronchodilation - airways widen",
                        "Increased respiratory rate",
                        "Enhanced oxygen uptake",
                        "Decreased mucus secretion"
                    ],
                    neurotransmitters: ["Epinephrine"],
                    receptors: "Œ≤2-adrenergic receptors",
                    mechanism: "Epinephrine binds to Œ≤2 receptors ‚Üí smooth muscle relaxation ‚Üí bronchodilation"
                },
                parasympathetic: {
                    effects: [
                        "Bronchoconstriction - airways narrow",
                        "Normal respiratory rate",
                        "Increased mucus secretion",
                        "Enhanced bronchial gland activity"
                    ],
                    neurotransmitters: ["Acetylcholine"],
                    receptors: "M3 muscarinic receptors",
                    mechanism: "ACh binds to M3 receptors ‚Üí smooth muscle contraction ‚Üí bronchoconstriction"
                }
            },
            digestive: {
                name: "Digestive System",
                icon: "ü´É",
                sympathetic: {
                    effects: [
                        "Decreased peristalsis and motility",
                        "Sphincter contraction (closes)",
                        "Reduced digestive enzyme secretion",
                        "Blood diverted away from GI tract"
                    ],
                    neurotransmitters: ["Norepinephrine"],
                    receptors: "Œ± and Œ≤-adrenergic receptors",
                    mechanism: "NE inhibits enteric nervous system ‚Üí decreased GI smooth muscle activity"
                },
                parasympathetic: {
                    effects: [
                        "Increased peristalsis and motility",
                        "Sphincter relaxation (opens)",
                        "Enhanced digestive enzyme secretion",
                        "Increased blood flow to GI tract"
                    ],
                    neurotransmitters: ["Acetylcholine"],
                    receptors: "M3 muscarinic receptors",
                    mechanism: "ACh stimulates enteric nervous system ‚Üí enhanced GI smooth muscle activity and secretions"
                }
            },
            eyes: {
                name: "Eyes (Pupils)",
                icon: "üëÅÔ∏è",
                sympathetic: {
                    effects: [
                        "Pupil dilation (mydriasis)",
                        "Allows more light entry",
                        "Enhanced distance vision",
                        "Reduced accommodation"
                    ],
                    neurotransmitters: ["Norepinephrine"],
                    receptors: "Œ±1-adrenergic receptors",
                    mechanism: "NE contracts radial muscle of iris ‚Üí pupil dilation"
                },
                parasympathetic: {
                    effects: [
                        "Pupil constriction (miosis)",
                        "Limits light entry",
                        "Enhanced near vision",
                        "Increased accommodation (lens thickens)"
                    ],
                    neurotransmitters: ["Acetylcholine"],
                    receptors: "M3 muscarinic receptors",
                    mechanism: "ACh contracts circular muscle of iris ‚Üí pupil constriction and ciliary muscle ‚Üí accommodation"
                }
            },
            blood_vessels: {
                name: "Blood Vessels",
                icon: "ü©∏",
                sympathetic: {
                    effects: [
                        "Vasoconstriction in skin and GI tract",
                        "Vasodilation in skeletal muscles",
                        "Increased blood pressure",
                        "Blood redistribution to vital organs"
                    ],
                    neurotransmitters: ["Norepinephrine", "Epinephrine"],
                    receptors: "Œ±1 (constriction), Œ≤2 (dilation)",
                    mechanism: "Œ±1 activation ‚Üí smooth muscle contraction; Œ≤2 activation ‚Üí smooth muscle relaxation"
                },
                parasympathetic: {
                    effects: [
                        "Limited direct effect on most vessels",
                        "Vasodilation in salivary glands",
                        "Vasodilation in genital tissues",
                        "Maintains basal vascular tone"
                    ],
                    neurotransmitters: ["Acetylcholine"],
                    receptors: "M3 muscarinic receptors",
                    mechanism: "ACh causes endothelial release of nitric oxide ‚Üí vasodilation (limited distribution)"
                }
            },
            liver: {
                name: "Liver",
                icon: "ü´Ä",
                sympathetic: {
                    effects: [
                        "Glycogenolysis (glucose release)",
                        "Gluconeogenesis activation",
                        "Increased blood glucose levels",
                        "Enhanced metabolism for energy"
                    ],
                    neurotransmitters: ["Norepinephrine", "Epinephrine"],
                    receptors: "Œ≤2-adrenergic receptors",
                    mechanism: "Epinephrine activates glycogen phosphorylase ‚Üí glucose mobilization"
                },
                parasympathetic: {
                    effects: [
                        "Glycogenesis (glucose storage)",
                        "Enhanced bile secretion",
                        "Promotes nutrient storage",
                        "Anabolic metabolism"
                    ],
                    neurotransmitters: ["Acetylcholine"],
                    receptors: "M3 muscarinic receptors",
                    mechanism: "ACh promotes glycogen synthesis and general metabolic storage functions"
                }
            }
        };

        const quizQuestions = [
            {
                question: "Which neurotransmitter is primarily responsible for parasympathetic effects on the heart?",
                options: [
                    "Norepinephrine",
                    "Acetylcholine",
                    "Epinephrine",
                    "Dopamine"
                ],
                correct: 1,
                explanation: "Acetylcholine (ACh) is the primary parasympathetic neurotransmitter that binds to M2 muscarinic receptors in the heart, causing decreased heart rate."
            },
            {
                question: "What effect does sympathetic stimulation have on the pupils?",
                options: [
                    "Pupil constriction (miosis)",
                    "No effect on pupils",
                    "Pupil dilation (mydriasis)",
                    "Alternating constriction and dilation"
                ],
                correct: 2,
                explanation: "Sympathetic stimulation causes pupil dilation (mydriasis) through norepinephrine acting on Œ±1-adrenergic receptors in the radial muscle of the iris."
            },
            {
                question: "Which receptor type mediates bronchodilation in the lungs?",
                options: [
                    "M3 muscarinic receptors",
                    "Œ±1-adrenergic receptors",
                    "Œ≤2-adrenergic receptors",
                    "Œ≤1-adrenergic receptors"
                ],
                correct: 2,
                explanation: "Œ≤2-adrenergic receptors mediate bronchodilation. Epinephrine binds to these receptors causing smooth muscle relaxation in the bronchi."
            },
            {
                question: "What happens to digestive system activity during sympathetic activation?",
                options: [
                    "Increased peristalsis and enzyme secretion",
                    "Decreased peristalsis and enzyme secretion",
                    "Increased peristalsis but decreased secretion",
                    "No change in digestive activity"
                ],
                correct: 1,
                explanation: "Sympathetic activation decreases digestive activity - reducing peristalsis, enzyme secretion, and blood flow to the GI tract as the body prioritizes resources for fight-or-flight."
            },
            {
                question: "Which effect does norepinephrine have on blood vessels in the skin during stress?",
                options: [
                    "Vasodilation",
                    "Vasoconstriction",
                    "No effect",
                    "Initial dilation then constriction"
                ],
                correct: 1,
                explanation: "Norepinephrine causes vasoconstriction in the skin via Œ±1-adrenergic receptors, redirecting blood to vital organs and muscles during stress."
            },
            {
                question: "What is the primary metabolic effect of sympathetic stimulation on the liver?",
                options: [
                    "Glycogen synthesis (glycogenesis)",
                    "Fat storage",
                    "Glucose release (glycogenolysis)",
                    "Protein synthesis"
                ],
                correct: 2,
                explanation: "Sympathetic stimulation causes glycogenolysis - the breakdown of glycogen to release glucose into the bloodstream, providing energy for the fight-or-flight response."
            },
            {
                question: "Which receptor type is responsible for increasing heart rate and contractility?",
                options: [
                    "M2 muscarinic receptors",
                    "Œ±1-adrenergic receptors",
                    "Œ≤1-adrenergic receptors",
                    "Œ≤2-adrenergic receptors"
                ],
                correct: 2,
                explanation: "Œ≤1-adrenergic receptors in the heart mediate positive chronotropic (increased rate) and inotropic (increased contractility) effects via norepinephrine and epinephrine."
            },
            {
                question: "What happens to the ciliary muscle of the eye during parasympathetic activation?",
                options: [
                    "Relaxation for distance vision",
                    "Contraction for near vision (accommodation)",
                    "No change",
                    "Alternating contraction and relaxation"
                ],
                correct: 1,
                explanation: "Parasympathetic activation causes ciliary muscle contraction via M3 receptors, allowing the lens to thicken for accommodation (near vision)."
            },
            {
                question: "Which second messenger is increased when norepinephrine binds to Œ≤1 receptors in the heart?",
                options: [
                    "IP3 (inositol triphosphate)",
                    "cGMP (cyclic GMP)",
                    "cAMP (cyclic AMP)",
                    "DAG (diacylglycerol)"
                ],
                correct: 2,
                explanation: "Œ≤1 receptor activation increases cAMP levels, which leads to enhanced calcium influx and increased cardiac contractility and heart rate."
            },
            {
                question: "During a marathon (sympathetic activation), what happens to cardiac output?",
                options: [
                    "Decreases to 2-3 L/min",
                    "Remains at 5 L/min",
                    "Increases to 20-25 L/min",
                    "Increases to 10-12 L/min"
                ],
                correct: 2,
                explanation: "During intense exercise with sympathetic activation, cardiac output can increase dramatically from the resting ~5 L/min to 20-25 L/min to meet metabolic demands."
            }
        ];

        let currentState = null;
        let userAnswers = [];
        let quizSubmitted = false;

        function createOrganCards() {
            const grid = document.getElementById('organGrid');
            grid.innerHTML = '';

            for (const [key, organ] of Object.entries(organData)) {
                const card = document.createElement('div');
                card.className = 'organ-card';
                card.id = `organ-${key}`;
                
                card.innerHTML = `
                    <h3><span class="organ-icon">${organ.icon}</span> ${organ.name}</h3>
                    
                    <div class="response-section sympathetic-response" id="symp-${key}">
                        <h4>‚ö° Sympathetic Response</h4>
                        <p><strong>Receptors:</strong> ${organ.sympathetic.receptors}</p>
                        <p><strong>Neurotransmitters:</strong> 
                            ${organ.sympathetic.neurotransmitters.map(nt => 
                                `<span class="neurotransmitter nt-${nt.toLowerCase()}">${nt}</span>`
                            ).join('')}
                        </p>
                        <p><strong>Mechanism:</strong> ${organ.sympathetic.mechanism}</p>
                        <p><strong>Effects:</strong></p>
                        <ul>
                            ${organ.sympathetic.effects.map(effect => `<li>${effect}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="response-section parasympathetic-response" id="para-${key}">
                        <h4>üåø Parasympathetic Response</h4>
                        <p><strong>Receptors:</strong> ${organ.parasympathetic.receptors}</p>
                        <p><strong>Neurotransmitters:</strong> 
                            ${organ.parasympathetic.neurotransmitters.map(nt => 
                                `<span class="neurotransmitter nt-${nt.toLowerCase()}">${nt}</span>`
                            ).join('')}
                        </p>
                        <p><strong>Mechanism:</strong> ${organ.parasympathetic.mechanism}</p>
                        <p><strong>Effects:</strong></p>
                        <ul>
                            ${organ.parasympathetic.effects.map(effect => `<li>${effect}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                grid.appendChild(card);
            }
        }

        function activateSympatheticNS() {
            currentState = 'sympathetic';
            updateButtons();
            
            for (const key of Object.keys(organData)) {
                const card = document.getElementById(`organ-${key}`);
                const sympSection = document.getElementById(`symp-${key}`);
                const paraSection = document.getElementById(`para-${key}`);
                
                card.classList.remove('parasympathetic-active');
                card.classList.add('sympathetic-active');
                sympSection.classList.add('show');
                paraSection.classList.remove('show');
            }
        }

        function activateParasympatheticNS() {
            currentState = 'parasympathetic';
            updateButtons();
            
            for (const key of Object.keys(organData)) {
                const card = document.getElementById(`organ-${key}`);
                const sympSection = document.getElementById(`symp-${key}`);
                const paraSection = document.getElementById(`para-${key}`);
                
                card.classList.remove('sympathetic-active');
                card.classList.add('parasympathetic-active');
                paraSection.classList.add('show');
                sympSection.classList.remove('show');
            }
        }

        function resetSystem() {
            currentState = null;
            updateButtons();
            
            for (const key of Object.keys(organData)) {
                const card = document.getElementById(`organ-${key}`);
                const sympSection = document.getElementById(`symp-${key}`);
                const paraSection = document.getElementById(`para-${key}`);
                
                card.classList.remove('sympathetic-active', 'parasympathetic-active');
                sympSection.classList.remove('show');
                paraSection.classList.remove('show');
            }
        }

        function updateButtons() {
            const sympBtn = document.querySelector('.btn-sympathetic');
            const paraBtn = document.querySelector('.btn-parasympathetic');
            
            sympBtn.classList.toggle('active', currentState === 'sympathetic');
            paraBtn.classList.toggle('active', currentState === 'parasympathetic');
        }

        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            if (tabName === 'analyzer') {
                tabs[0].classList.add('active');
                document.getElementById('analyzer-tab').classList.add('active');
            } else if (tabName === 'quiz') {
                tabs[1].classList.add('active');
                document.getElementById('quiz-tab').classList.add('active');
            }
        }

        function createQuiz() {
            const container = document.getElementById('quizQuestions');
            container.innerHTML = '';
            userAnswers = new Array(quizQuestions.length).fill(null);
            quizSubmitted = false;

            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.id = `question-${index}`;

                const optionsHTML = q.options.map((option, optIndex) => `
                    <div class="quiz-option" onclick="selectAnswer(${index}, ${optIndex})" id="option-${index}-${optIndex}">
                        ${String.fromCharCode(65 + optIndex)}. ${option}
                    </div>
                `).join('');

                questionDiv.innerHTML = `
                    <div class="question-text">Question ${index + 1}: ${q.question}</div>
                    <div class="quiz-options">
                        ${optionsHTML}
                    </div>
                    <div class="feedback" id="feedback-${index}"></div>
                `;

                container.appendChild(questionDiv);
            });

            updateScore();
        }

        function selectAnswer(questionIndex, optionIndex) {
            if (quizSubmitted) return;

            userAnswers[questionIndex] = optionIndex;

            const options = document.querySelectorAll(`#question-${questionIndex} .quiz-option`);
            options.forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                }
            });
        }

        function submitQuiz() {
            if (quizSubmitted) return;

            const unanswered = userAnswers.filter(a => a === null).length;
            if (unanswered > 0) {
                alert(`Please answer all questions. ${unanswered} question(s) remaining.`);
                return;
            }

            quizSubmitted = true;
            let correctCount = 0;

            quizQuestions.forEach((q, index) => {
                const questionDiv = document.getElementById(`question-${index}`);
                const isCorrect = userAnswers[index] === q.correct;
                const feedback = document.getElementById(`feedback-${index}`);

                if (isCorrect) {
                    correctCount++;
                    questionDiv.classList.add('correct');
                    feedback.className = 'feedback correct show';
                    feedback.innerHTML = `‚úì Correct! ${q.explanation}`;
                } else {
                    questionDiv.classList.add('incorrect');
                    feedback.className = 'feedback incorrect show';
                    feedback.innerHTML = `‚úó Incorrect. The correct answer is ${String.fromCharCode(65 + q.correct)}. ${q.explanation}`;
                }

                const options = document.querySelectorAll(`#question-${index} .quiz-option`);
                options.forEach((opt, idx) => {
                    opt.style.pointerEvents = 'none';
                    if (idx === q.correct) {
                        opt.classList.add('correct-answer');
                    } else if (idx === userAnswers[index] && idx !== q.correct) {
                        opt.classList.add('wrong-answer');
                    }
                });
            });

            showResults(correctCount);
        }

        function showResults(correctCount) {
            const total = quizQuestions.length;
            const percentage = (correctCount / total) * 100;
            
            const completeDiv = document.getElementById('quizComplete');
            const finalScore = document.getElementById('finalScore');
            const performanceBadge = document.getElementById('performanceBadge');
            const performanceText = document.getElementById('performanceText');

            finalScore.textContent = `${correctCount} / ${total} (${percentage.toFixed(0)}%)`;

            if (percentage >= 90) {
                performanceBadge.textContent = 'üèÜ';
                performanceText.textContent = 'Outstanding! You have excellent mastery of ANS physiology!';
            } else if (percentage >= 80) {
                performanceBadge.textContent = 'üåü';
                performanceText.textContent = 'Great job! You have a strong understanding of the material!';
            } else if (percentage >= 70) {
                performanceBadge.textContent = 'üëç';
                performanceText.textContent = 'Good work! Review the feedback to strengthen your knowledge.';
            } else if (percentage >= 60) {
                performanceBadge.textContent = 'üìö';
                performanceText.textContent = 'Fair performance. Review the material and try again.';
            } else {
                performanceBadge.textContent = 'üí™';
                performanceText.textContent = 'Keep studying! Review the organ analyzer tab and retake the quiz.';
            }

            completeDiv.classList.add('show');
            completeDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function resetQuiz() {
            document.getElementById('quizComplete').classList.remove('show');
            createQuiz();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateScore() {
            const answered = userAnswers.filter(a => a !== null).length;
            const total = quizQuestions.length;
            document.getElementById('score').textContent = `${answered} / ${total}`;
        }

        createOrganCards();
        createQuiz();
    </script>
</body>
</html>
