<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic CD11b/CD18 (Mac-1) Integrin Viewer</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --lipid-head: #64748b;
            --lipid-tail: #475569;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        h1 { margin-bottom: 5px; font-weight: 300; letter-spacing: 1px; }
        .subtitle { color: #94a3b8; font-size: 0.9rem; margin-bottom: 25px; max-width: 600px; text-align: center; }

        /* --- STAGE CONTAINER --- */
        #viewport {
            position: relative;
            width: 800px;
            height: 500px;
            background: radial-gradient(circle at 50% 30%, #1e293b 0%, #020617 100%);
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            overflow: hidden;
            border: 1px solid #334155;
        }

        /* --- SVG STYLES --- */
        svg {
            width: 100%;
            height: 100%;
        }

        /* Organic Protein Styles */
        .protein-domain {
            stroke: rgba(0,0,0,0.2);
            stroke-width: 1px;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4));
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Alpha Chain (CD11b) */
        .alpha-fill { fill: url(#grad-alpha); }
        .alpha-I-domain { fill: url(#grad-alpha-I); stroke: #60a5fa; stroke-width: 2px; }
        
        /* Beta Chain (CD18) */
        .beta-fill { fill: url(#grad-beta); }

        /* Membrane */
        .lipid-head { fill: #94a3b8; opacity: 0.8; }
        .lipid-tail { stroke: #64748b; stroke-width: 2; opacity: 0.5; }

        /* Ligand (iC3b) */
        .ligand-body { fill: url(#grad-ligand); filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.4)); opacity: 0; transition: opacity 0.5s; }

        /* Animations via CSS Classes on Groups */
        
        /* The Knee Pivot (Genu) */
        #alpha-upper, #beta-upper {
            transform-box: fill-box;
            transform-origin: bottom center;
            transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Inactive State (Default in SVG) */
        /* We set the default in the SVG coords, but we use classes to animate */

        /* Activated State */
        .is-active #alpha-upper { transform: rotate(-100deg); } /* Unbend */
        .is-active #beta-upper { transform: rotate(100deg); }   /* Unbend */
        
        /* Note: The SVG is drawn in the "Bent" state by default for the "upper" groups? 
           Actually, drawing it "Extended" (straight) and bending it via CSS is easier. 
           Let's draw EXTENDED, then apply .bent class by default. */
           
        .bent #alpha-upper { transform: rotate(130deg) translate(10px, 20px); }
        .bent #beta-upper { transform: rotate(-130deg) translate(-10px, 20px); }
        
        /* When we remove .bent, it straightens out to 0deg (Extended) */

        /* Separation of legs (Cytoplasmic separation) */
        #alpha-leg, #beta-leg {
            transition: transform 1.2s ease;
            transform-box: fill-box;
            transform-origin: bottom center;
        }
        
        /* In bent state, legs are close. In active, they might separate slightly or stay similar.
           We will mainly focus on the "Switchblade" opening. */

        /* Ligand Animation */
        #ligand-group {
            transition: transform 1s ease-out;
        }
        .ligand-floating { transform: translate(400px, -100px); opacity: 0.5; }
        .ligand-bound { transform: translate(0, 0); opacity: 1; }
        
        /* --- CONTROLS --- */
        .controls-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            background: #1e293b;
            padding: 15px 30px;
            border-radius: 50px;
            border: 1px solid #334155;
        }

        button {
            background: #334155;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        button:hover:not(:disabled) { background: #475569; transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        button.primary { background: var(--accent-blue); }
        button.primary:hover:not(:disabled) { background: #2563eb; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4); }

        /* --- INFO --- */
        .info-card {
            margin-top: 20px;
            background: rgba(30, 41, 59, 0.8);
            border-left: 4px solid var(--accent-green);
            padding: 20px;
            border-radius: 8px;
            max-width: 800px;
            line-height: 1.6;
        }
        .info-card strong { color: var(--accent-green); }

    </style>
</head>
<body>

    <h1>CD11b/CD18 Molecular Simulator</h1>
    <p class="subtitle">Real-time simulation of Mac-1 Integrin conformational activation and ligand binding</p>

    <div id="viewport">
        <svg viewBox="0 0 800 500" preserveAspectRatio="xMidYMid slice">
            <defs>
                <radialGradient id="grad-alpha" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" stop-color="#60a5fa" />
                    <stop offset="100%" stop-color="#1d4ed8" />
                </radialGradient>
                <radialGradient id="grad-alpha-I" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" stop-color="#a5f3fc" />
                    <stop offset="100%" stop-color="#0891b2" />
                </radialGradient>
                <radialGradient id="grad-beta" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" stop-color="#34d399" />
                    <stop offset="100%" stop-color="#059669" />
                </radialGradient>
                <radialGradient id="grad-ligand" cx="40%" cy="40%" r="80%">
                    <stop offset="0%" stop-color="#f87171" />
                    <stop offset="100%" stop-color="#b91c1c" />
                </radialGradient>
            </defs>

            <g id="membrane-layer" transform="translate(0, 400)">
                </g>

            <g transform="translate(400, 380)">
                
                <g id="beta-leg" class="protein-domain beta-fill">
                    <ellipse cx="-15" cy="-20" rx="8" ry="12" transform="rotate(-10)" />
                    <ellipse cx="-15" cy="-40" rx="8" ry="12" transform="rotate(-5)" />
                    <ellipse cx="-15" cy="-60" rx="8" ry="12" />
                    <ellipse cx="-15" cy="-80" rx="9" ry="14" /> <g id="beta-upper" transform="translate(-15, -80)"> 
                        <ellipse cx="0" cy="-25" rx="10" ry="15" transform="rotate(-10)" />
                        <path d="M -15 -40 Q -25 -70 0 -80 Q 25 -70 15 -40 Z" />
                    </g>
                </g>

                <g id="alpha-leg" class="protein-domain alpha-fill">
                    <ellipse cx="15" cy="-20" rx="9" ry="14" transform="rotate(10)" />
                    <ellipse cx="15" cy="-50" rx="10" ry="16" transform="rotate(5)" />
                    <ellipse cx="15" cy="-85" rx="12" ry="18" /> <g id="alpha-upper" transform="translate(15, -85)">
                        <circle cx="0" cy="-40" r="22" />
                        <g class="alpha-I-domain">
                            <path d="M -15 -60 C -25 -95 25 -95 15 -60 L 0 -50 Z" />
                            <circle cx="0" cy="-75" r="4" fill="#fbbf24" stroke="none">
                                <animate attributeName="opacity" values="0.2;1;0.2" dur="3s" repeatCount="indefinite" />
                            </circle>
                        </g>
                    </g>
                </g>

            </g>

            <g id="ligand-group" class="ligand-floating" transform="translate(415, 150)">
                <path class="ligand-body" d="M -30 -20 Q 0 -50 30 -20 Q 50 20 0 40 Q -50 20 -30 -20" />
                <text x="0" y="5" text-anchor="middle" fill="white" font-size="12" font-weight="bold" font-family="sans-serif">iC3b</text>
            </g>

        </svg>
    </div>

    <div class="controls-area">
        <button id="btn-stimulate" class="primary" onclick="stimulate()">
            <span>âš¡ Stimulate (Inside-Out)</span>
        </button>
        <button id="btn-bind" onclick="bindLigand()" disabled>
            <span>ðŸ”— Bind Ligand</span>
        </button>
        <button id="btn-reset" onclick="resetSim()">
            <span>â†º Reset</span>
        </button>
    </div>

    <div class="info-card" id="status-text">
        <strong>Status: Resting State (Bent-Closed)</strong><br>
        The integrin is in a low-affinity conformation. The "Headpiece" (containing the ligand-binding I-domain) is bent back towards the cell membrane. This prevents premature binding to blood vessel walls.
    </div>

    <script>
        // Generate Lipid Bilayer
        const membraneGroup = document.getElementById('membrane-layer');
        const width = 800;
        const lipidWidth = 15;
        
        for(let i = 0; i < width/lipidWidth; i++) {
            const x = i * lipidWidth;
            // Top layer
            let head = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            head.setAttribute("cx", x); head.setAttribute("cy", 0); head.setAttribute("r", 6);
            head.setAttribute("class", "lipid-head");
            
            let tail = document.createElementNS("http://www.w3.org/2000/svg", "path");
            tail.setAttribute("d", `M ${x} 0 L ${x} 25`);
            tail.setAttribute("class", "lipid-tail");

            // Bottom layer
            let head2 = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            head2.setAttribute("cx", x); head2.setAttribute("cy", 50); head2.setAttribute("r", 6);
            head2.setAttribute("class", "lipid-head");

            let tail2 = document.createElementNS("http://www.w3.org/2000/svg", "path");
            tail2.setAttribute("d", `M ${x} 50 L ${x} 25`);
            tail2.setAttribute("class", "lipid-tail");

            membraneGroup.appendChild(tail);
            membraneGroup.appendChild(tail2);
            membraneGroup.appendChild(head);
            membraneGroup.appendChild(head2);
        }

        // State Management
        const viewport = document.getElementById('viewport');
        const ligandGroup = document.getElementById('ligand-group');
        const statusText = document.getElementById('status-text');
        const btnStimulate = document.getElementById('btn-stimulate');
        const btnBind = document.getElementById('btn-bind');

        // Initial State: Bent
        viewport.classList.add('bent');

        function stimulate() {
            // Remove bent class -> Triggers CSS transition to 0deg rotation (Extended)
            viewport.classList.remove('bent');
            
            statusText.innerHTML = `
                <strong>Status: Activated (Extended-Open)</strong><br>
                Chemokine signaling has triggered "Inside-Out" activation. The integrin extends like a switchblade. 
                The <span style="color:#60a5fa">CD11b I-domain</span> is now elevated (~20nm) above the membrane, exposing the MIDAS site (gold) to catch passing ligands.
            `;
            
            btnStimulate.disabled = true;
            setTimeout(() => {
                btnBind.disabled = false;
                btnBind.classList.add('primary'); // Highlight next step
            }, 1000);
        }

        function bindLigand() {
            // Move ligand to the binding site
            ligandGroup.classList.remove('ligand-floating');
            ligandGroup.setAttribute("transform", "translate(415, 205)"); // Coordinates matching the Extended I-domain tip
            ligandGroup.style.opacity = "1";

            statusText.innerHTML = `
                <strong>Status: Ligand Bound (Firm Adhesion)</strong><br>
                The iC3b ligand has docked into the <strong>Metal Ion-Dependent Adhesion Site (MIDAS)</strong>. 
                This transmits force into the cell (Outside-In signaling), locking the cytoskeleton and allowing the immune cell to stop rolling and migrate.
            `;
            
            btnBind.disabled = true;
            btnBind.classList.remove('primary');
        }

        function resetSim() {
            viewport.classList.add('bent');
            ligandGroup.classList.add('ligand-floating');
            ligandGroup.style.opacity = "0";
            ligandGroup.setAttribute("transform", "translate(415, 150)"); // Reset pos

            statusText.innerHTML = `
                <strong>Status: Resting State (Bent-Closed)</strong><br>
                The integrin returns to its inactive surveillance mode.
            `;

            btnStimulate.disabled = false;
            btnBind.disabled = true;
            btnBind.classList.remove('primary');
        }

    </script>
</body>
</html>
